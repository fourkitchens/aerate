<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="sift 0.0.1" />
    <meta name="description" content="Sift results for 9/6/2017" />

    <title>Sift</title>

    <link rel="stylesheet" href="mapper/sift/css/style.css" media="all" />
    <link type="text/css" rel="stylesheet" href="node_modules/britecharts/dist/css/britecharts.min.css">
    <link href="https://fonts.googleapis.com/css?family=Arimo|Poiret+One|Source+Code+Pro" rel="stylesheet">
  </head>
  <body>
    <h1>Sift</h1>
    <div class="content">
      <!-- <ul class="menu">
        <li><a href="#summary">Summary</a></li>
        <li><a href="#charts">Charts</a></li>
        <li><a href="#optimisations">Optimisations</a></li>
      </ul> -->

      <div id="britecharts">
        <div class="chart">
          <div class="chart__meta">
            <h2 class="chart__title">First Byte</h2>
            <p class="chart__description">The First Byte time (often abbreviated as TTFB) is measured as the time from the start of the initial navigation until the first byte of the base page is received by the browser (after following redirects).</p>
            <span class="chart__stats">Budget:<span class="chart__budget"></span></span>
            <span class="chart__stats">Results:<span class="chart__results"></span></span>
            <span class="chart__stats"><span class="chart__passed">Passed</span></span>
          </div>
          <div class="chart__data">
            <div class="chart__barchart"></div>
            <span class="chart__label">milliseconds</span>
          </div>
        </div>
        <div class="chart">
          <div class="chart__meta">
            <h2 class="chart__title">Start Render</h2>
            <p class="chart__description">The Start Render time is the first point in time that something was displayed to the screen.  Before this point in time the user was staring at a blank page.  This does not necessarily mean the user saw the page content, it could just be something as simple as a background color but it is the first indication of something happening for the user.</p>
            <span class="chart__stats">Budget:<span class="chart__budget"></span></span>
            <span class="chart__stats">Results:<span class="chart__results"></span></span>
            <span class="chart__stats"><span class="chart__passed">Passed</span></span>
          </div>
          <div class="chart__data">
            <div class="chart__barchart"></div>
            <span class="chart__label">milliseconds</span>
          </div>
        </div>
        <div class="chart">
          <div class="chart__meta">
            <h2 class="chart__title">Document Complete</h2>
            <p class="chart__description">The metrics grouped together under the Document Complete heading are the metrics collected up until the browser considered the page loaded (onLoad event for those familiar with the javascript events).  This usually happens after all of the images content have loaded but may not include content that is triggered by javascript execution.</p>
            <span class="chart__stats">Budget:<span class="chart__budget"></span></span>
            <span class="chart__stats">Results:<span class="chart__results"></span></span>
            <span class="chart__stats"><span class="chart__passed">Passed</span></span>
          </div>
          <div class="chart__data">
            <div class="chart__barchart"></div>
            <span class="chart__label">milliseconds</span>
          </div>
        </div>
        <div class="chart">
          <div class="chart__meta">
            <h2 class="chart__title">Fully Loaded</h2>
            <p class="chart__description">The metrics grouped together under the Fully Loaded heading are the metrics collected up until there was 2 seconds of no network activity after Document Complete.  This will usually include any activity that is triggered by javascript after the main page loads</p>
            <span class="chart__stats">Budget:<span class="chart__budget"></span></span>
            <span class="chart__stats">Results:<span class="chart__results"></span></span>
            <span class="chart__stats"><span class="chart__passed">Passed</span></span>
          </div>
          <div class="chart__data">
            <div class="chart__barchart"></div>
            <span class="chart__label">milliseconds</span>
          </div>
        </div>
      </div>

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/britecharts/2.0.0/bundled/britecharts.min.js"></script>
    <script>
    var newMap = [[{"percentage":204,"name":"Results","id":1},{"percentage":500,"name":"Budget","id":0,"class":""}],[{"percentage":871,"name":"Results","id":1},{"percentage":700,"name":"Budget","id":0,"class":"over-budget"}],[{"percentage":2430,"name":"Results","id":1},{"percentage":4000,"name":"Budget","id":0,"class":""}],[{"percentage":2430,"name":"Results","id":1},{"percentage":5500,"name":"Budget","id":0,"class":""}]];
    for (var i = 0, len = newMap.length; i < len; i++) {
      var briteElement = document.querySelectorAll('.chart');
      var briteChart = briteElement[i];
      var briteElementChart = briteElement[i].querySelectorAll('.chart__barchart');
      var budgetData = newMap[i];

      // Data
      var budgetSpan = briteElement[i].querySelectorAll('.chart__budget');
      budgetSpan[0].textContent = ' ' + budgetData[1].percentage;

      var resultsSpan = briteElement[i].querySelectorAll('.chart__results');
      resultsSpan[0].textContent = ' ' + budgetData[0].percentage;

      // Britecharts
      var colors = ['#ffce00', '#6aedc7'];
      if (budgetData[1].class.length > 0) {
        briteElement[i].classList.add('over-budget');
        colors = ['#ffce00', '#f55573'];

        var statusSpan = briteElement[i].querySelectorAll('.chart__passed');
        statusSpan[0].textContent = ' Failed';
      }

      function createHorizontalBarChart() {
        let tooltip = new britecharts.miniTooltip();
        let barChart = new britecharts.bar(),
            margin = {
              left: 80,
              right: 20,
              top: 20,
              bottom: 30
            },
            barContainer = d3.select(briteElementChart[0]),
            containerWidth = barContainer.node() ? barContainer.node().getBoundingClientRect().width : false;

        if (containerWidth) {
          barChart
             .isHorizontal(true)
             .margin(margin)
             .width(containerWidth)
             .colorSchema(colors)
             .valueLabel('percentage')
             .isAnimated(true)
             .percentageAxisToMaxRatio(1.2)
             .height(200)
             .on('customMouseOver', tooltip.show)
             .on('customMouseMove', tooltip.update)
             .on('customMouseOut', tooltip.hide);

          barContainer.datum(budgetData).call(barChart);
        }

        var tooltipItem = briteElement[i].querySelectorAll('.metadata-group');
        tooltipContainer = d3.select(tooltipItem[0]);
        tooltipContainer.datum([]).call(tooltip);

        // Responsive
        const redrawChart = () => {
          var allCharts = document.querySelectorAll('.chart__barchart');
          let container = d3.select(allCharts[i]);
          let newContainerWidth = container.node() ? container.node().getBoundingClientRect().width : false;

          // Setting the new width on the chart
          barChart.width(newContainerWidth);

          // Rendering the chart again
          container.datum(budgetData).call(barChart);
        };

        window.addEventListener("resize", redrawChart);
      }
      createHorizontalBarChart();
    }
    </script>
  </body>
</html>
